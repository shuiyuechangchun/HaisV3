#!/sbin/sh
set -e
ZIP=$3
OUTFD=/proc/self/fd/$2;
ui_print() { echo -e "ui_print $1\nui_print" > $OUTFD; }
package_extract_file(){ busybox unzip -p "$ZIP" $1 > $2;}
if [ -d /tmp/Hais ];then rm -r /tmp/Hais ; fi
mkdir -p /tmp/Hais/ReplaceFile

unzip "$ZIP" META-INF/pw/hais/rom/ReplaceFile.dat -d /tmp/Hais
unzip /tmp/Hais/META-INF/pw/hais/rom/ReplaceFile.dat -d /tmp/Hais/ReplaceFile
chmod -R 0755 /tmp/Hais
export PATH=/tmp/Hais/ReplaceFile:$PATH

ui_print " "
ui_print " "
ui_print " Redmi K30Pro 养老 "
ui_print " Hais制作"
ui_print " "
ui_print " 刷入有点久，请耐心等待！ "
ui_print " "
ui_print "刷入底层……"





ui_print "刷入系统……"
busybox unzip -p "$ZIP" system.new.dat.brx | zstd -c -d > /dev/block/bootdevice/by-name/super
busybox unzip -p "$ZIP" boot.img > /dev/block/bootdevice/by-name/boot
ui_print "刷入完成"
ui_print "挂载错误信息不用管，直接重启既可"
ui_print "内置了Magisk，请不要再刷Magisk卡刷包，可能会不开机"

exit 0
